// Mock state management and global dependencies
vi.mock("/@/store", () => ({
  useAppStore: () => ({
    getTheme: vi.fn(() => "light"),
    setTheme: vi.fn(),
    locale: "en",
    setLocale: vi.fn()
  }),
  useUserStore: () => ({
    userInfo: { name: "Test User" },
    isLoggedIn: true
  })
}));

vi.mock("/@/hooks/setting/useLocale", () => ({
  useLocale: () => ({
    getLocale: vi.fn(() => ({ lang: "en" })),
    changeLocale: vi.fn(),
    t: vi.fn((key) => key)
  })
}));

// Mock state management and global dependencies
vi.mock("/@/store", () => ({
  useAppStore: () => ({
    getTheme: vi.fn(() => "light"),
    setTheme: vi.fn(),
    locale: "en",
    setLocale: vi.fn()
  }),
  useUserStore: () => ({
    userInfo: { name: "Test User" },
    isLoggedIn: true
  })
}));

vi.mock("/@/hooks/setting/useLocale", () => ({
  useLocale: () => ({
    getLocale: vi.fn(() => ({ lang: "en" })),
    changeLocale: vi.fn(),
    t: vi.fn((key) => key)
  })
}));

// Mock state management and global dependencies
vi.mock("/@/store", () => ({
  useAppStore: () => ({
    getTheme: vi.fn(() => "light"),
    setTheme: vi.fn(),
    locale: "en",
    setLocale: vi.fn()
  }),
  useUserStore: () => ({
    userInfo: { name: "Test User" },
    isLoggedIn: true
  })
}));

vi.mock("/@/hooks/setting/useLocale", () => ({
  useLocale: () => ({
    getLocale: vi.fn(() => ({ lang: "en" })),
    changeLocale: vi.fn(),
    t: vi.fn((key) => key)
  })
}));

// Mock state management and global dependencies
vi.mock("/@/store", () => ({
  useAppStore: () => ({
    getTheme: vi.fn(() => "light"),
    setTheme: vi.fn(),
    locale: "en",
    setLocale: vi.fn()
  }),
  useUserStore: () => ({
    userInfo: { name: "Test User" },
    isLoggedIn: true
  })
}));

vi.mock("/@/hooks/setting/useLocale", () => ({
  useLocale: () => ({
    getLocale: vi.fn(() => ({ lang: "en" })),
    changeLocale: vi.fn(),
    t: vi.fn((key) => key)
  })
}));

// Mock state management and global dependencies
vi.mock("/@/store", () => ({
  useAppStore: () => ({
    getTheme: vi.fn(() => "light"),
    setTheme: vi.fn(),
    locale: "en",
    setLocale: vi.fn()
  }),
  useUserStore: () => ({
    userInfo: { name: "Test User" },
    isLoggedIn: true
  })
}));

vi.mock("/@/hooks/setting/useLocale", () => ({
  useLocale: () => ({
    getLocale: vi.fn(() => ({ lang: "en" })),
    changeLocale: vi.fn(),
    t: vi.fn((key) => key)
  })
}));

// Mock state management and global dependencies
vi.mock("/@/store", () => ({
  useAppStore: () => ({
    getTheme: vi.fn(() => "light"),
    setTheme: vi.fn(),
    locale: "en",
    setLocale: vi.fn()
  }),
  useUserStore: () => ({
    userInfo: { name: "Test User" },
    isLoggedIn: true
  })
}));

vi.mock("/@/hooks/setting/useLocale", () => ({
  useLocale: () => ({
    getLocale: vi.fn(() => ({ lang: "en" })),
    changeLocale: vi.fn(),
    t: vi.fn((key) => key)
  })
}));

// Mock state management and global dependencies
vi.mock("/@/store", () => ({
  useAppStore: () => ({
    getTheme: vi.fn(() => "light"),
    setTheme: vi.fn(),
    locale: "en",
    setLocale: vi.fn()
  }),
  useUserStore: () => ({
    userInfo: { name: "Test User" },
    isLoggedIn: true
  })
}));

vi.mock("/@/hooks/setting/useLocale", () => ({
  useLocale: () => ({
    getLocale: vi.fn(() => ({ lang: "en" })),
    changeLocale: vi.fn(),
    t: vi.fn((key) => key)
  })
}));

// Mock state management and global dependencies
vi.mock("/@/store", () => ({
  useAppStore: () => ({
    getTheme: vi.fn(() => "light"),
    setTheme: vi.fn(),
    locale: "en",
    setLocale: vi.fn()
  }),
  useUserStore: () => ({
    userInfo: { name: "Test User" },
    isLoggedIn: true
  })
}));

vi.mock("/@/hooks/setting/useLocale", () => ({
  useLocale: () => ({
    getLocale: vi.fn(() => ({ lang: "en" })),
    changeLocale: vi.fn(),
    t: vi.fn((key) => key)
  })
}));

// Mock state management and global dependencies
vi.mock("/@/store", () => ({
  useAppStore: () => ({
    getTheme: vi.fn(() => "light"),
    setTheme: vi.fn(),
    locale: "en",
    setLocale: vi.fn()
  }),
  useUserStore: () => ({
    userInfo: { name: "Test User" },
    isLoggedIn: true
  })
}));

vi.mock("/@/hooks/setting/useLocale", () => ({
  useLocale: () => ({
    getLocale: vi.fn(() => ({ lang: "en" })),
    changeLocale: vi.fn(),
    t: vi.fn((key) => key)
  })
}));

// Mock state management and global dependencies
vi.mock("/@/store", () => ({
  useAppStore: () => ({
    getTheme: vi.fn(() => "light"),
    setTheme: vi.fn(),
    locale: "en",
    setLocale: vi.fn()
  }),
  useUserStore: () => ({
    userInfo: { name: "Test User" },
    isLoggedIn: true
  })
}));

vi.mock("/@/hooks/setting/useLocale", () => ({
  useLocale: () => ({
    getLocale: vi.fn(() => ({ lang: "en" })),
    changeLocale: vi.fn(),
    t: vi.fn((key) => key)
  })
}));

// Mock state management and global dependencies
vi.mock("/@/store", () => ({
  useAppStore: () => ({
    getTheme: vi.fn(() => "light"),
    setTheme: vi.fn(),
    locale: "en",
    setLocale: vi.fn()
  }),
  useUserStore: () => ({
    userInfo: { name: "Test User" },
    isLoggedIn: true
  })
}));

vi.mock("/@/hooks/setting/useLocale", () => ({
  useLocale: () => ({
    getLocale: vi.fn(() => ({ lang: "en" })),
    changeLocale: vi.fn(),
    t: vi.fn((key) => key)
  })
}));

// Mock state management and global dependencies
vi.mock("/@/store", () => ({
  useAppStore: () => ({
    getTheme: vi.fn(() => "light"),
    setTheme: vi.fn(),
    locale: "en",
    setLocale: vi.fn()
  }),
  useUserStore: () => ({
    userInfo: { name: "Test User" },
    isLoggedIn: true
  })
}));

vi.mock("/@/hooks/setting/useLocale", () => ({
  useLocale: () => ({
    getLocale: vi.fn(() => ({ lang: "en" })),
    changeLocale: vi.fn(),
    t: vi.fn((key) => key)
  })
}));

// Mock state management and global dependencies
vi.mock("/@/store", () => ({
  useAppStore: () => ({
    getTheme: vi.fn(() => "light"),
    setTheme: vi.fn(),
    locale: "en",
    setLocale: vi.fn()
  }),
  useUserStore: () => ({
    userInfo: { name: "Test User" },
    isLoggedIn: true
  })
}));

vi.mock("/@/hooks/setting/useLocale", () => ({
  useLocale: () => ({
    getLocale: vi.fn(() => ({ lang: "en" })),
    changeLocale: vi.fn(),
    t: vi.fn((key) => key)
  })
}));

// Mock state management and global dependencies
vi.mock("/@/store", () => ({
  useAppStore: () => ({
    getTheme: vi.fn(() => "light"),
    setTheme: vi.fn(),
    locale: "en",
    setLocale: vi.fn()
  }),
  useUserStore: () => ({
    userInfo: { name: "Test User" },
    isLoggedIn: true
  })
}));

vi.mock("/@/hooks/setting/useLocale", () => ({
  useLocale: () => ({
    getLocale: vi.fn(() => ({ lang: "en" })),
    changeLocale: vi.fn(),
    t: vi.fn((key) => key)
  })
}));

// Mock state management and global dependencies
vi.mock("/@/store", () => ({
  useAppStore: () => ({
    getTheme: vi.fn(() => "light"),
    setTheme: vi.fn(),
    locale: "en",
    setLocale: vi.fn()
  }),
  useUserStore: () => ({
    userInfo: { name: "Test User" },
    isLoggedIn: true
  })
}));

vi.mock("/@/hooks/setting/useLocale", () => ({
  useLocale: () => ({
    getLocale: vi.fn(() => ({ lang: "en" })),
    changeLocale: vi.fn(),
    t: vi.fn((key) => key)
  })
}));

// Mock state management and global dependencies
vi.mock("/@/store", () => ({
  useAppStore: () => ({
    getTheme: vi.fn(() => "light"),
    setTheme: vi.fn(),
    locale: "en",
    setLocale: vi.fn()
  }),
  useUserStore: () => ({
    userInfo: { name: "Test User" },
    isLoggedIn: true
  })
}));

vi.mock("/@/hooks/setting/useLocale", () => ({
  useLocale: () => ({
    getLocale: vi.fn(() => ({ lang: "en" })),
    changeLocale: vi.fn(),
    t: vi.fn((key) => key)
  })
}));

// Mock state management and global dependencies
vi.mock("/@/store", () => ({
  useAppStore: () => ({
    getTheme: vi.fn(() => "light"),
    setTheme: vi.fn(),
    locale: "en",
    setLocale: vi.fn()
  }),
  useUserStore: () => ({
    userInfo: { name: "Test User" },
    isLoggedIn: true
  })
}));

vi.mock("/@/hooks/setting/useLocale", () => ({
  useLocale: () => ({
    getLocale: vi.fn(() => ({ lang: "en" })),
    changeLocale: vi.fn(),
    t: vi.fn((key) => key)
  })
}));

// Mock state management and global dependencies
vi.mock("/@/store", () => ({
  useAppStore: () => ({
    getTheme: vi.fn(() => "light"),
    setTheme: vi.fn(),
    locale: "en",
    setLocale: vi.fn()
  }),
  useUserStore: () => ({
    userInfo: { name: "Test User" },
    isLoggedIn: true
  })
}));

vi.mock("/@/hooks/setting/useLocale", () => ({
  useLocale: () => ({
    getLocale: vi.fn(() => ({ lang: "en" })),
    changeLocale: vi.fn(),
    t: vi.fn((key) => key)
  })
}));

// Mock state management and global dependencies
vi.mock("/@/store", () => ({
  useAppStore: () => ({
    getTheme: vi.fn(() => "light"),
    setTheme: vi.fn(),
    locale: "en",
    setLocale: vi.fn()
  }),
  useUserStore: () => ({
    userInfo: { name: "Test User" },
    isLoggedIn: true
  })
}));

vi.mock("/@/hooks/setting/useLocale", () => ({
  useLocale: () => ({
    getLocale: vi.fn(() => ({ lang: "en" })),
    changeLocale: vi.fn(),
    t: vi.fn((key) => key)
  })
}));

// Mock state management and global dependencies
vi.mock("/@/store", () => ({
  useAppStore: () => ({
    getTheme: vi.fn(() => "light"),
    setTheme: vi.fn(),
    locale: "en",
    setLocale: vi.fn()
  }),
  useUserStore: () => ({
    userInfo: { name: "Test User" },
    isLoggedIn: true
  })
}));

vi.mock("/@/hooks/setting/useLocale", () => ({
  useLocale: () => ({
    getLocale: vi.fn(() => ({ lang: "en" })),
    changeLocale: vi.fn(),
    t: vi.fn((key) => key)
  })
}));

// Mock state management and global dependencies
vi.mock("/@/store", () => ({
  useAppStore: () => ({
    getTheme: vi.fn(() => "light"),
    setTheme: vi.fn(),
    locale: "en",
    setLocale: vi.fn()
  }),
  useUserStore: () => ({
    userInfo: { name: "Test User" },
    isLoggedIn: true
  })
}));

vi.mock("/@/hooks/setting/useLocale", () => ({
  useLocale: () => ({
    getLocale: vi.fn(() => ({ lang: "en" })),
    changeLocale: vi.fn(),
    t: vi.fn((key) => key)
  })
}));

// Mock state management and global dependencies
vi.mock("/@/store", () => ({
  useAppStore: () => ({
    getTheme: vi.fn(() => "light"),
    setTheme: vi.fn(),
    locale: "en",
    setLocale: vi.fn()
  }),
  useUserStore: () => ({
    userInfo: { name: "Test User" },
    isLoggedIn: true
  })
}));

vi.mock("/@/hooks/setting/useLocale", () => ({
  useLocale: () => ({
    getLocale: vi.fn(() => ({ lang: "en" })),
    changeLocale: vi.fn(),
    t: vi.fn((key) => key)
  })
}));

// Mock state management and global dependencies
vi.mock("/@/store", () => ({
  useAppStore: () => ({
    getTheme: vi.fn(() => "light"),
    setTheme: vi.fn(),
    locale: "en",
    setLocale: vi.fn()
  }),
  useUserStore: () => ({
    userInfo: { name: "Test User" },
    isLoggedIn: true
  })
}));

vi.mock("/@/hooks/setting/useLocale", () => ({
  useLocale: () => ({
    getLocale: vi.fn(() => ({ lang: "en" })),
    changeLocale: vi.fn(),
    t: vi.fn((key) => key)
  })
}));

// Mock state management and global dependencies
vi.mock("/@/store", () => ({
  useAppStore: () => ({
    getTheme: vi.fn(() => "light"),
    setTheme: vi.fn(),
    locale: "en",
    setLocale: vi.fn()
  }),
  useUserStore: () => ({
    userInfo: { name: "Test User" },
    isLoggedIn: true
  })
}));

vi.mock("/@/hooks/setting/useLocale", () => ({
  useLocale: () => ({
    getLocale: vi.fn(() => ({ lang: "en" })),
    changeLocale: vi.fn(),
    t: vi.fn((key) => key)
  })
}));

// Mock state management and global dependencies
vi.mock("/@/store", () => ({
  useAppStore: () => ({
    getTheme: vi.fn(() => "light"),
    setTheme: vi.fn(),
    locale: "en",
    setLocale: vi.fn()
  }),
  useUserStore: () => ({
    userInfo: { name: "Test User" },
    isLoggedIn: true
  })
}));

vi.mock("/@/hooks/setting/useLocale", () => ({
  useLocale: () => ({
    getLocale: vi.fn(() => ({ lang: "en" })),
    changeLocale: vi.fn(),
    t: vi.fn((key) => key)
  })
}));

// Mock state management and global dependencies
vi.mock("/@/store", () => ({
  useAppStore: () => ({
    getTheme: vi.fn(() => "light"),
    setTheme: vi.fn(),
    locale: "en",
    setLocale: vi.fn()
  }),
  useUserStore: () => ({
    userInfo: { name: "Test User" },
    isLoggedIn: true
  })
}));

vi.mock("/@/hooks/setting/useLocale", () => ({
  useLocale: () => ({
    getLocale: vi.fn(() => ({ lang: "en" })),
    changeLocale: vi.fn(),
    t: vi.fn((key) => key)
  })
}));

// Mock state management and global dependencies
vi.mock("/@/store", () => ({
  useAppStore: () => ({
    getTheme: vi.fn(() => "light"),
    setTheme: vi.fn(),
    locale: "en",
    setLocale: vi.fn()
  }),
  useUserStore: () => ({
    userInfo: { name: "Test User" },
    isLoggedIn: true
  })
}));

vi.mock("/@/hooks/setting/useLocale", () => ({
  useLocale: () => ({
    getLocale: vi.fn(() => ({ lang: "en" })),
    changeLocale: vi.fn(),
    t: vi.fn((key) => key)
  })
}));

// Mock state management and global dependencies
vi.mock("/@/store", () => ({
  useAppStore: () => ({
    getTheme: vi.fn(() => "light"),
    setTheme: vi.fn(),
    locale: "en",
    setLocale: vi.fn()
  }),
  useUserStore: () => ({
    userInfo: { name: "Test User" },
    isLoggedIn: true
  })
}));

vi.mock("/@/hooks/setting/useLocale", () => ({
  useLocale: () => ({
    getLocale: vi.fn(() => ({ lang: "en" })),
    changeLocale: vi.fn(),
    t: vi.fn((key) => key)
  })
}));

// Mock state management and global dependencies
vi.mock("/@/store", () => ({
  useAppStore: () => ({
    getTheme: vi.fn(() => "light"),
    setTheme: vi.fn(),
    locale: "en",
    setLocale: vi.fn()
  }),
  useUserStore: () => ({
    userInfo: { name: "Test User" },
    isLoggedIn: true
  })
}));

vi.mock("/@/hooks/setting/useLocale", () => ({
  useLocale: () => ({
    getLocale: vi.fn(() => ({ lang: "en" })),
    changeLocale: vi.fn(),
    t: vi.fn((key) => key)
  })
}));

// Mock state management and global dependencies
vi.mock("/@/store", () => ({
  useAppStore: () => ({
    getTheme: vi.fn(() => "light"),
    setTheme: vi.fn(),
    locale: "en",
    setLocale: vi.fn()
  }),
  useUserStore: () => ({
    userInfo: { name: "Test User" },
    isLoggedIn: true
  })
}));

vi.mock("/@/hooks/setting/useLocale", () => ({
  useLocale: () => ({
    getLocale: vi.fn(() => ({ lang: "en" })),
    changeLocale: vi.fn(),
    t: vi.fn((key) => key)
  })
}));

// Mock state management and global dependencies
vi.mock("/@/store", () => ({
  useAppStore: () => ({
    getTheme: vi.fn(() => "light"),
    setTheme: vi.fn(),
    locale: "en",
    setLocale: vi.fn()
  }),
  useUserStore: () => ({
    userInfo: { name: "Test User" },
    isLoggedIn: true
  })
}));

vi.mock("/@/hooks/setting/useLocale", () => ({
  useLocale: () => ({
    getLocale: vi.fn(() => ({ lang: "en" })),
    changeLocale: vi.fn(),
    t: vi.fn((key) => key)
  })
}));

// Mock state management and global dependencies
vi.mock("/@/store", () => ({
  useAppStore: () => ({
    getTheme: vi.fn(() => "light"),
    setTheme: vi.fn(),
    locale: "en",
    setLocale: vi.fn()
  }),
  useUserStore: () => ({
    userInfo: { name: "Test User" },
    isLoggedIn: true
  })
}));

vi.mock("/@/hooks/setting/useLocale", () => ({
  useLocale: () => ({
    getLocale: vi.fn(() => ({ lang: "en" })),
    changeLocale: vi.fn(),
    t: vi.fn((key) => key)
  })
}));

// Mock state management and global dependencies
vi.mock("/@/store", () => ({
  useAppStore: () => ({
    getTheme: vi.fn(() => "light"),
    setTheme: vi.fn(),
    locale: "en",
    setLocale: vi.fn()
  }),
  useUserStore: () => ({
    userInfo: { name: "Test User" },
    isLoggedIn: true
  })
}));

vi.mock("/@/hooks/setting/useLocale", () => ({
  useLocale: () => ({
    getLocale: vi.fn(() => ({ lang: "en" })),
    changeLocale: vi.fn(),
    t: vi.fn((key) => key)
  })
}));

// Mock state management and global dependencies
vi.mock("/@/store", () => ({
  useAppStore: () => ({
    getTheme: vi.fn(() => "light"),
    setTheme: vi.fn(),
    locale: "en",
    setLocale: vi.fn()
  }),
  useUserStore: () => ({
    userInfo: { name: "Test User" },
    isLoggedIn: true
  })
}));

vi.mock("/@/hooks/setting/useLocale", () => ({
  useLocale: () => ({
    getLocale: vi.fn(() => ({ lang: "en" })),
    changeLocale: vi.fn(),
    t: vi.fn((key) => key)
  })
}));

// Mock state management and global dependencies
vi.mock("/@/store", () => ({
  useAppStore: () => ({
    getTheme: vi.fn(() => "light"),
    setTheme: vi.fn(),
    locale: "en",
    setLocale: vi.fn()
  }),
  useUserStore: () => ({
    userInfo: { name: "Test User" },
    isLoggedIn: true
  })
}));

vi.mock("/@/hooks/setting/useLocale", () => ({
  useLocale: () => ({
    getLocale: vi.fn(() => ({ lang: "en" })),
    changeLocale: vi.fn(),
    t: vi.fn((key) => key)
  })
}));

// Mock state management and global dependencies
vi.mock("/@/store", () => ({
  useAppStore: () => ({
    getTheme: vi.fn(() => "light"),
    setTheme: vi.fn(),
    locale: "en",
    setLocale: vi.fn()
  }),
  useUserStore: () => ({
    userInfo: { name: "Test User" },
    isLoggedIn: true
  })
}));

vi.mock("/@/hooks/setting/useLocale", () => ({
  useLocale: () => ({
    getLocale: vi.fn(() => ({ lang: "en" })),
    changeLocale: vi.fn(),
    t: vi.fn((key) => key)
  })
}));

// Mock state management and global dependencies
vi.mock("/@/store", () => ({
  useAppStore: () => ({
    getTheme: vi.fn(() => "light"),
    setTheme: vi.fn(),
    locale: "en",
    setLocale: vi.fn()
  }),
  useUserStore: () => ({
    userInfo: { name: "Test User" },
    isLoggedIn: true
  })
}));

vi.mock("/@/hooks/setting/useLocale", () => ({
  useLocale: () => ({
    getLocale: vi.fn(() => ({ lang: "en" })),
    changeLocale: vi.fn(),
    t: vi.fn((key) => key)
  })
}));

// Mock state management and global dependencies
vi.mock("/@/store", () => ({
  useAppStore: () => ({
    getTheme: vi.fn(() => "light"),
    setTheme: vi.fn(),
    locale: "en",
    setLocale: vi.fn()
  }),
  useUserStore: () => ({
    userInfo: { name: "Test User" },
    isLoggedIn: true
  })
}));

vi.mock("/@/hooks/setting/useLocale", () => ({
  useLocale: () => ({
    getLocale: vi.fn(() => ({ lang: "en" })),
    changeLocale: vi.fn(),
    t: vi.fn((key) => key)
  })
}));

import { describe, it, expect, vi } from 'vitest';
import {
  getBoundingClientRect,
  hasClass,
  addClass,
  removeClass,
  getViewportOffset,
  hackCss,
  on,
  off,
  once,
  useRafThrottle,
} from '/@/utils/domUtils';

describe('utils/domUtils', () => {
  describe('getBoundingClientRect', () => {
    it('should return 0 for invalid element', () => {
      expect(getBoundingClientRect(null as any)).toBe(0);
    });

    it('should return bounding rect for valid element', () => {
      const mockElement = {
        getBoundingClientRect: vi.fn().mockReturnValue({ x: 10, y: 20, width: 100, height: 50 }),
      } as any;

      const result = getBoundingClientRect(mockElement);
      expect(result).toEqual({ x: 10, y: 20, width: 100, height: 50 });
    });
  });

  describe('hasClass', () => {
    it('should return false for invalid element or class', () => {
      expect(hasClass(null as any, 'test')).toBe(false);
      expect(hasClass({} as any, '')).toBe(false);
    });

    it('should throw error for class with space', () => {
      expect(() => hasClass({} as any, 'test class')).toThrow('className should not contain space');
    });

    it('should check class with classList', () => {
      const mockElement = {
        classList: {
          contains: vi.fn().mockReturnValue(true),
        },
      } as any;

      expect(hasClass(mockElement, 'test')).toBe(true);
      expect(mockElement.classList.contains).toHaveBeenCalledWith('test');
    });

    it('should check class without classList', () => {
      const mockElement = {
        className: 'test other-class',
      } as any;

      expect(hasClass(mockElement, 'test')).toBe(true);
      expect(hasClass(mockElement, 'non-existent')).toBe(false);
    });
  });

  describe('addClass', () => {
    it('should not add class for invalid element', () => {
      expect(() => addClass(null as any, 'test')).not.toThrow();
    });

    it('should add class with classList', () => {
      const mockElement = {
        classList: {
          add: vi.fn(),
        },
        className: '',
      } as any;

      addClass(mockElement, 'test');
      expect(mockElement.classList.add).toHaveBeenCalledWith('test');
    });

    it('should add class without classList', () => {
      const mockElement = {
        className: 'existing-class',
      } as any;

      addClass(mockElement, 'new-class');
      expect(mockElement.className).toBe('existing-class new-class');
    });

    it('should not add duplicate class without classList', () => {
      const mockElement = {
        className: 'existing-class',
      } as any;

      addClass(mockElement, 'existing-class');
      expect(mockElement.className).toBe('existing-class');
    });

    it('should handle empty class string', () => {
      const mockElement = {
        className: 'existing-class',
      } as any;

      addClass(mockElement, '');
      expect(mockElement.className).toBe('existing-class');
    });

    it('should handle multiple classes', () => {
      const mockElement = {
        classList: {
          add: vi.fn(),
        },
        className: '',
      } as any;

      addClass(mockElement, 'class1 class2');
      expect(mockElement.classList.add).toHaveBeenCalledWith('class1');
      expect(mockElement.classList.add).toHaveBeenCalledWith('class2');
    });
  });

  describe('removeClass', () => {
    it('should not remove class for invalid element or class', () => {
      expect(() => removeClass(null as any, 'test')).not.toThrow();
      expect(() => removeClass({} as any, '')).not.toThrow();
    });

    it('should remove class with classList', () => {
      const mockElement = {
        classList: {
          remove: vi.fn(),
        },
        className: 'test',
      } as any;

      removeClass(mockElement, 'test');
      expect(mockElement.classList.remove).toHaveBeenCalledWith('test');
    });

    it('should remove class without classList', () => {
      const mockElement = {
        className: 'test other-class',
      } as any;

      removeClass(mockElement, 'test');
      expect(mockElement.className).toBe('other-class');
    });

    it('should not remove non-existent class without classList', () => {
      const mockElement = {
        className: 'existing-class',
      } as any;

      removeClass(mockElement, 'non-existent');
      expect(mockElement.className).toBe('existing-class');
    });

    it('should handle multiple classes', () => {
      const mockElement = {
        classList: {
          remove: vi.fn(),
        },
        className: 'class1 class2 class3',
      } as any;

      removeClass(mockElement, 'class1 class2');
      expect(mockElement.classList.remove).toHaveBeenCalledWith('class1');
      expect(mockElement.classList.remove).toHaveBeenCalledWith('class2');
    });

    it('should handle empty class name', () => {
      const mockElement = {
        className: 'existing-class',
      } as any;

      removeClass(mockElement, '');
      expect(mockElement.className).toBe('existing-class');
    });

    it('should handle multiple classes with empty class name', () => {
      const mockElement = {
        classList: {
          remove: vi.fn(),
        },
        className: 'class1 class2 class3',
      } as any;

      removeClass(mockElement, 'class1  class2'); // Note the double space
      expect(mockElement.classList.remove).toHaveBeenCalledWith('class1');
      expect(mockElement.classList.remove).toHaveBeenCalledWith('class2');
    });
  });

  describe('trim', () => {
    it('should trim whitespace from string', () => {
      // We can't directly test the trim function since it's not exported
      // But we can test it indirectly through other functions that use it
      const mockElement = {
        className: '  test-class  other-class  ',
      } as any;

      removeClass(mockElement, 'test-class');
      // The trim function is used in removeClass when el.classList is not available
      expect(mockElement.className).toBe('other-class');
    });

    it('should handle empty string', () => {
      // We can't directly test the trim function since it's not exported
      // But we can test it indirectly through other functions that use it
      const mockElement = {
        className: '   ',
      } as any;

      removeClass(mockElement, 'test-class');
      // The trim function is used in removeClass when el.classList is not available
      expect(mockElement.className).toBe('');
    });

    it('should handle null or undefined string', () => {
      // We can't directly test the trim function since it's not exported
      // But we can test it indirectly through other functions that use it
      const mockElement1 = {
        className: null,
      } as any;

      const mockElement2 = {
        className: undefined,
      } as any;

      removeClass(mockElement1, 'test-class');
      removeClass(mockElement2, 'test-class');
      // The trim function is used in removeClass when el.classList is not available
      // When className is null or undefined, it should be treated as empty string
    });
  });

  describe('getViewportOffset', () => {
    it('should calculate viewport offset', () => {
      // Mock document and window properties
      const mockDoc = {
        scrollLeft: 10,
        scrollTop: 20,
        clientLeft: 5,
        clientTop: 5,
        documentElement: {
          clientWidth: 800,
          clientHeight: 600,
        },
      };

      // Mock window properties
      const originalDocument = global.document;
      const originalWindow = global.window;

      global.document = mockDoc as any;
      global.window = {
        ...originalWindow,
        pageXOffset: 15,
        pageYOffset: 25,
        document: mockDoc,
      } as any;

      const mockElement = {
        getBoundingClientRect: vi.fn().mockReturnValue({
          left: 100,
          top: 50,
          width: 200,
          height: 100,
        }),
      } as any;

      const result = getViewportOffset(mockElement);

      expect(result).toHaveProperty('left');
      expect(result).toHaveProperty('top');
      expect(result).toHaveProperty('right');
      expect(result).toHaveProperty('bottom');
      expect(result).toHaveProperty('rightIncludeBody');
      expect(result).toHaveProperty('bottomIncludeBody');

      // Restore original globals
      global.document = originalDocument;
      global.window = originalWindow;
    });

    it('should handle missing pageXOffset and pageYOffset', () => {
      // Mock document and window properties
      const mockDoc = {
        scrollLeft: 10,
        scrollTop: 20,
        clientLeft: 5,
        clientTop: 5,
        documentElement: {
          clientWidth: 800,
          clientHeight: 600,
        },
      };

      // Mock window properties without pageXOffset and pageYOffset
      const originalDocument = global.document;
      const originalWindow = global.window;

      global.document = mockDoc as any;
      global.window = {
        ...originalWindow,
        pageXOffset: undefined,
        pageYOffset: undefined,
        document: mockDoc,
      } as any;

      const mockElement = {
        getBoundingClientRect: vi.fn().mockReturnValue({
          left: 100,
          top: 50,
          width: 200,
          height: 100,
        }),
      } as any;

      const result = getViewportOffset(mockElement);

      expect(result).toHaveProperty('left');
      expect(result).toHaveProperty('top');

      // Restore original globals
      global.document = originalDocument;
      global.window = originalWindow;
    });
  });

  describe('hackCss', () => {
    it('should generate css with prefixes', () => {
      const result = hackCss('transform', 'rotate(45deg)');
      expect(result).toHaveProperty('transform', 'rotate(45deg)');
      expect(result).toHaveProperty('webkitTransform', 'rotate(45deg)');
      expect(result).toHaveProperty('MozTransform', 'rotate(45deg)');
      expect(result).toHaveProperty('msTransform', 'rotate(45deg)');
      expect(result).toHaveProperty('OTTransform', 'rotate(45deg)');
    });
  });

  describe('event handlers', () => {
    it('should add event listener', () => {
      const mockElement = {
        addEventListener: vi.fn(),
      } as any;
      const handler = vi.fn();

      on(mockElement, 'click', handler);
      expect(mockElement.addEventListener).toHaveBeenCalledWith('click', handler, false);
    });

    it('should remove event listener', () => {
      const mockElement = {
        removeEventListener: vi.fn(),
      } as any;
      const handler = vi.fn();

      off(mockElement, 'click', handler);
      expect(mockElement.removeEventListener).toHaveBeenCalledWith('click', handler, false);
    });

    it('should add and remove event listener once', () => {
      const mockElement = {
        addEventListener: vi.fn(),
        removeEventListener: vi.fn(),
      } as any;
      const handler = vi.fn();

      once(mockElement, 'click', handler);
      expect(mockElement.addEventListener).toHaveBeenCalled();
    });

    it('should handle once event correctly', () => {
      let registeredHandler: any;
      const mockElement = {
        addEventListener: vi.fn((event, handler) => {
          registeredHandler = handler;
        }),
        removeEventListener: vi.fn(),
      } as any;
      const handler = vi.fn();

      once(mockElement, 'click', handler);

      // Simulate event firing
      if (registeredHandler) {
        registeredHandler.call(mockElement);
      }

      expect(handler).toHaveBeenCalled();
      expect(mockElement.removeEventListener).toHaveBeenCalledWith('click', registeredHandler, false);
    });
  });

  describe('useRafThrottle', () => {
    it('should throttle function with requestAnimationFrame', () => {
      // Mock requestAnimationFrame if it doesn't exist
      const originalRaf = window.requestAnimationFrame;
      window.requestAnimationFrame = window.requestAnimationFrame || ((cb) => setTimeout(() => cb(0), 16) as any);

      vi.useFakeTimers();
      let rafCallback: FrameRequestCallback | null = null;
      const mockRaf = vi.spyOn(window, 'requestAnimationFrame').mockImplementation((cb) => {
        rafCallback = cb;
        return 1;
      });

      const fn = vi.fn();
      const throttledFn = useRafThrottle(fn);

      throttledFn();
      throttledFn(); // This should be ignored due to throttling

      // Execute the requestAnimationFrame callback
      if (rafCallback) {
        rafCallback(0);
      }

      expect(fn).toHaveBeenCalledTimes(1);

      mockRaf.mockRestore();
      vi.useRealTimers();

      // Restore original requestAnimationFrame
      window.requestAnimationFrame = originalRaf;
    });

    it('should handle multiple calls with locked state', () => {
      // Mock requestAnimationFrame if it doesn't exist
      const originalRaf = window.requestAnimationFrame;
      window.requestAnimationFrame = window.requestAnimationFrame || ((cb) => setTimeout(() => cb(0), 16) as any);

      let rafCallback: FrameRequestCallback | null = null;
      const mockRaf = vi.spyOn(window, 'requestAnimationFrame').mockImplementation((cb) => {
        rafCallback = cb;
        return 1;
      });

      const fn = vi.fn();
      const throttledFn = useRafThrottle(fn);

      // Call multiple times quickly
      throttledFn();
      throttledFn();
      throttledFn();

      // Execute the requestAnimationFrame callback
      if (rafCallback) {
        rafCallback(0);
      }

      // Should only be called once due to throttling
      expect(fn).toHaveBeenCalledTimes(1);

      // Now call again after RAF has executed
      throttledFn();

      // Execute the requestAnimationFrame callback again
      if (rafCallback) {
        rafCallback(0);
      }

      // Should be called twice now
      expect(fn).toHaveBeenCalledTimes(2);

      mockRaf.mockRestore();

      // Restore original requestAnimationFrame
      window.requestAnimationFrame = originalRaf;
    });
  });
});
